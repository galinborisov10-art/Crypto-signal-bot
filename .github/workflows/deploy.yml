name: Auto Deploy to DigitalOcean

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ” Checkout Code
      uses: actions/checkout@v3
    
    - name: ğŸš€ Deploy to DigitalOcean
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.DO_HOST }}
        username: ${{ secrets.DO_USERNAME }}
        key: ${{ secrets.DO_SSH_KEY }}
        port: ${{ secrets.DO_PORT || 22 }}
        script: |
          cd ~/Crypto-signal-bot || cd /var/www/crypto-bot || cd /opt/crypto-bot
          
          echo "ğŸ“¥ Pulling latest changes..."
          git pull origin main
          
          echo "ğŸ“¦ Installing dependencies..."
          pip3 install -r requirements.txt --upgrade
          
          echo "ğŸ”„ Restarting bot with PM2..."
          pm2 restart crypto-bot || pm2 start ecosystem.config.js
          
          echo "âœ… Deploy completed successfully!"
          pm2 status
    
    - name: ğŸ“¢ Notify Success
      if: success()
      run: |
        echo "âœ… Deployment successful!"
        
    - name: ğŸ“¢ Notify Failure
      if: failure()
      run: |
        echo "âŒ Deployment failed!"
